<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computer Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Select2 for multi-select dropdown -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        .sidebar {
            min-height: 100vh;
            background-color: #343a40;
            position: relative;
        }
        .sidebar .nav-link {
            color: #fff;
        }
        .sidebar .nav-link:hover {
            background-color: #495057;
        }
        .sidebar .nav-link.active {
            background-color: #0d6efd;
        }
        .sidebar .nav-link.text-danger:hover {
            background-color: #dc3545;
            color: white !important;
        }
        .position-sticky {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .status-working { color: #198754; }
        .status-maintenance { color: #ffc107; }
        .status-defective { color: #dc3545; }
        .qr-code-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .qr-code-item {
            text-align: center;
            width: 180px;
        }
        .qr-code {
            width: 150px;
            height: 150px;
            border: 1px solid #ddd;
            padding: 10px;
            background: white;
            margin-bottom: 10px;
        }
        .qr-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        @media print {
            .no-print {
                display: none !important;
            }
            .qr-code-container {
                page-break-inside: avoid;
            }
        }
        .select2-container--default .select2-selection--multiple {
            border: 1px solid #ced4da;
            border-radius: 0.375rem;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse bg-dark">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4 class="text-white">CLMS</h4>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="dashboard.html">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="computer_management.html">
                                <i class="fas fa-laptop me-2"></i>
                                Computer Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="department_management.html">
                                <i class="fas fa-book me-2"></i>
                                Course/Department Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="instructor_management.html">
                                <i class="fas fa-users me-2"></i>
                                Instructor Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="student_management.html">
                                <i class="fas fa-user-graduate me-2"></i>
                                Students Management
                            </a>
                        </li>
                    </ul>
                    
                    <!-- Logout Section at Bottom -->
                    <div class="sidebar-footer mt-auto" style="position: absolute; bottom: 20px; width: 100%;">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link text-danger" href="#" onclick="logout()">
                                    <i class="fas fa-sign-out-alt me-2"></i>
                                    Logout
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Computer Management</h1>
                </div>

                <!-- Action Buttons -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#laboratoryModal">
                            <i class="fas fa-building me-2"></i>Laboratory Management
                        </button>
                        <button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#addComputerModal">
                            <i class="fas fa-plus me-2"></i>Add Computer
                        </button>
                        <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#generateQRModal">
                            <i class="fas fa-qrcode me-2"></i>Generate QR
                        </button>
                    </div>
                </div>

                <!-- Computers Table -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Computers List</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Laboratory</th>
                                        <th>PC Number</th>
                                        <th>Status</th>
                                        <th>Last Updated</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="computersTableBody">
                                    <!-- Computers will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Laboratory Management Modal -->
    <div class="modal fade" id="laboratoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Laboratory Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="laboratoryForm">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="labName" class="form-label">Laboratory Name</label>
                                <input type="text" class="form-control" id="labName" placeholder="Enter laboratory name" required>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-plus me-2"></i>Add Laboratory
                                </button>
                            </div>
                        </div>
                    </form>

                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Laboratory Name</th>
                                    <th>Computers Count</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="laboratoriesTableBody">
                                <!-- Laboratories will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Computer Modal -->
    <div class="modal fade" id="addComputerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Computer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="computerForm">
                        <div class="mb-3">
                            <label for="computerLab" class="form-label">Laboratory</label>
                            <select class="form-select" id="computerLab" required>
                                <option value="">Select Laboratory</option>
                                <!-- Laboratories will be populated here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="pcNumber" class="form-label">PC Number</label>
                            <input type="text" class="form-control" id="pcNumber" placeholder="e.g., PC 1" required>
                        </div>
                        <div class="mb-3">
                            <label for="computerStatus" class="form-label">Status</label>
                            <select class="form-select" id="computerStatus" required>
                                <option value="Working">Working</option>
                                <option value="Under Maintenance">Under Maintenance</option>
                                <option value="Defective">Defective</option>
                            </select>
                        </div>
                        <div class="text-end">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save me-2"></i>Add Computer
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Computer Modal -->
    <div class="modal fade" id="editComputerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Computer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editComputerForm">
                        <input type="hidden" id="editComputerId">
                        <div class="mb-3">
                            <label for="editComputerLab" class="form-label">Laboratory</label>
                            <select class="form-select" id="editComputerLab" required>
                                <!-- Laboratories will be populated here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editPcNumber" class="form-label">PC Number</label>
                            <input type="text" class="form-control" id="editPcNumber" required>
                        </div>
                        <div class="mb-3">
                            <label for="editComputerStatus" class="form-label">Status</label>
                            <select class="form-select" id="editComputerStatus" required>
                                <option value="Working">Working</option>
                                <option value="Under Maintenance">Under Maintenance</option>
                                <option value="Defective">Defective</option>
                            </select>
                        </div>
                        <div class="text-end">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Update Computer
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Generate QR Modal -->
    <div class="modal fade" id="generateQRModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Generate QR Codes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="qrForm">
                        <div class="mb-3">
                            <label for="qrLab" class="form-label">Laboratory</label>
                            <select class="form-select" id="qrLab" required>
                                <option value="">Select Laboratory</option>
                                <!-- Laboratories will be populated here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="qrComputers" class="form-label">Select Computers</label>
                            <select class="form-select" id="qrComputers" multiple="multiple" required>
                                <!-- Computers will be populated here -->
                            </select>
                        </div>
                        <div class="text-end">
                            <button type="submit" class="btn btn-info">
                                <i class="fas fa-qrcode me-2"></i>Generate QR Codes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Codes Display Modal -->
    <div class="modal fade" id="qrDisplayModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Generated QR Codes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="qrCodesContainer" class="qr-code-container">
                        <!-- QR codes will be displayed here -->
                    </div>
                    <div class="text-center no-print">
                        <button class="btn btn-success" onclick="printQRCodes()">
                            <i class="fas fa-print me-2"></i>Print QR Codes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <!-- Select2 for multi-select dropdown -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // Data storage
        let laboratories = JSON.parse(localStorage.getItem('laboratories')) || [];
        let computers = JSON.parse(localStorage.getItem('computers')) || [];
        let computerIdCounter = parseInt(localStorage.getItem('computerIdCounter')) || 1;
        let labIdCounter = parseInt(localStorage.getItem('labIdCounter')) || 1;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateLaboratoriesTable();
            updateComputersTable();
            populateLabSelects();
            initializeSelect2();
        });

        // Enhanced logout function with SweetAlert2
        function logout() {
            Swal.fire({
                title: 'Logout?',
                text: 'Are you sure you want to logout?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, logout!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    // You can add any cleanup code here if needed
                    localStorage.removeItem('currentUser'); // If you have user sessions
                    window.location.href = 'index.html';
                }
            });
            return false; // Prevent immediate navigation
        }

        // Initialize Select2 for multi-select
        function initializeSelect2() {
            $('#qrComputers').select2({
                placeholder: "Select computers",
                allowClear: true,
                width: '100%',
                dropdownParent: $('#generateQRModal')
            });
        }

        // Function to print only QR codes
        function printQRCodes() {
            // Create a new window for printing
            const printWindow = window.open('', '_blank');
            
            // Get the QR codes container HTML
            const qrContent = document.getElementById('qrCodesContainer').innerHTML;
            
            // Create the print document
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Print QR Codes</title>
                    <style>
                        body {
                            margin: 0;
                            padding: 20px;
                            font-family: Arial, sans-serif;
                        }
                        .qr-code-container {
                            display: flex;
                            flex-wrap: wrap;
                            gap: 20px;
                            justify-content: center;
                        }
                        .qr-row {
                            display: flex;
                            flex-wrap: wrap;
                            justify-content: center;
                            gap: 20px;
                            margin-bottom: 20px;
                            page-break-inside: avoid;
                        }
                        .qr-code-item {
                            text-align: center;
                            width: 180px;
                        }
                        .qr-code {
                            width: 150px;
                            height: 150px;
                            border: 1px solid #ddd;
                            padding: 5px;
                            background: white;
                            margin-bottom: 10px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            overflow: hidden;
                        }
                        .qr-code img {
                            max-width: 100%;
                            max-height: 100%;
                            object-fit: contain;
                        }
                        .qr-label {
                            font-size: 12px;
                            line-height: 1.3;
                        }
                        @media print {
                            body {
                                padding: 0;
                            }
                            .qr-row {
                                page-break-inside: avoid;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="qr-code-container">
                        ${qrContent}
                    </div>
                    <script>
                        window.onload = function() {
                            window.print();
                            setTimeout(function() {
                                window.close();
                            }, 100);
                        };
                    <\/script>
                </body>
                </html>
            `);
            
            printWindow.document.close();
        }

        // Laboratory Management
        document.getElementById('laboratoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const labName = document.getElementById('labName').value.trim();
            
            if (labName) {
                // Check if laboratory name already exists (case insensitive)
                const labExists = laboratories.some(lab => 
                    lab.name.toLowerCase() === labName.toLowerCase()
                );
                
                if (labExists) {
                    // Show error message if laboratory already exists
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Laboratory name already exists. Please use a different name.',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'OK'
                    });
                    return; // Stop execution if lab exists
                }
                
                const newLab = {
                    id: labIdCounter++,
                    name: labName,
                    createdAt: new Date().toISOString()
                };
                
                laboratories.push(newLab);
                saveData();
                updateLaboratoriesTable();
                populateLabSelects();
                document.getElementById('laboratoryForm').reset();
                
                // Show success message
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: 'Laboratory added successfully!',
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'OK'
                });
            }
        });

        // Add Computer
        document.getElementById('computerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const labId = parseInt(document.getElementById('computerLab').value);
            const pcNumber = document.getElementById('pcNumber').value.trim();
            const status = document.getElementById('computerStatus').value;
            
            if (labId && pcNumber) {
                // Check if PC number already exists in the selected laboratory
                const pcExists = computers.some(computer => 
                    computer.labId === labId && 
                    computer.pcNumber.toLowerCase() === pcNumber.toLowerCase()
                );
                
                if (pcExists) {
                    // Show error message if PC number already exists in this lab
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'PC number already exists in this laboratory. Please use a different PC number.',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'OK'
                    });
                    return; // Stop execution if PC number exists
                }
                
                const lab = laboratories.find(l => l.id === labId);
                const newComputer = {
                    id: computerIdCounter++,
                    labId: labId,
                    labName: lab.name,
                    pcNumber: pcNumber,
                    status: status,
                    lastUpdated: new Date().toISOString()
                };
                
                computers.push(newComputer);
                saveData();
                updateComputersTable();
                document.getElementById('computerForm').reset();
                bootstrap.Modal.getInstance(document.getElementById('addComputerModal')).hide();
                
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: 'Computer added successfully!',
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'OK'
                });
            }
        });

        // Edit Computer
        document.getElementById('editComputerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const computerId = parseInt(document.getElementById('editComputerId').value);
            const labId = parseInt(document.getElementById('editComputerLab').value);
            const pcNumber = document.getElementById('editPcNumber').value.trim();
            const status = document.getElementById('editComputerStatus').value;
            
            const computer = computers.find(c => c.id === computerId);
            if (computer) {
                // Check if PC number already exists in the selected laboratory (excluding current computer)
                const pcExists = computers.some(comp => 
                    comp.id !== computerId && // Exclude the current computer being edited
                    comp.labId === labId && 
                    comp.pcNumber.toLowerCase() === pcNumber.toLowerCase()
                );
                
                if (pcExists) {
                    // Show error message if PC number already exists in this lab
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'PC number already exists in this laboratory. Please use a different PC number.',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'OK'
                    });
                    return; // Stop execution if PC number exists
                }
                
                const lab = laboratories.find(l => l.id === labId);
                computer.labId = labId;
                computer.labName = lab.name;
                computer.pcNumber = pcNumber;
                computer.status = status;
                computer.lastUpdated = new Date().toISOString();
                
                saveData();
                updateComputersTable();
                bootstrap.Modal.getInstance(document.getElementById('editComputerModal')).hide();
                
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: 'Computer updated successfully!',
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'OK'
                });
            }
        });

        // Generate QR Codes
        document.getElementById('qrForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const labId = parseInt(document.getElementById('qrLab').value);
            const selectedComputers = $('#qrComputers').val();
            
            if (labId && selectedComputers && selectedComputers.length > 0) {
                generateQRCodes(labId, selectedComputers);
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error!',
                    text: 'Please select a laboratory and at least one computer.',
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'OK'
                });
            }
        });

        // Function to generate QR codes
        function generateQRCodes(labId, computerIds) {
            const qrContainer = document.getElementById('qrCodesContainer');
            qrContainer.innerHTML = '';
            
            const lab = laboratories.find(l => l.id === labId);
            const selectedComputers = computers.filter(c => computerIds.includes(c.id.toString()));
            
            // Create rows with max 5 QR codes per row
            const qrRows = [];
            for (let i = 0; i < selectedComputers.length; i += 5) {
                qrRows.push(selectedComputers.slice(i, i + 5));
            }
            
            qrRows.forEach(row => {
                const qrRow = document.createElement('div');
                qrRow.className = 'qr-row';
                
                row.forEach(computer => {
                    const qrItem = document.createElement('div');
                    qrItem.className = 'qr-code-item';
                    
                    const qrDiv = document.createElement('div');
                    qrDiv.className = 'qr-code';
                    
                    // QR code data - you can customize this
                    const qrData = JSON.stringify({
                        lab: lab.name,
                        pcNumber: computer.pcNumber,
                        id: computer.id,
                        system: "CLMS"
                    });
                    
                    // Generate QR code using qrcode-generator
                    try {
                        const typeNumber = 0; // Auto detect type
                        const errorCorrectionLevel = 'L';
                        const qr = qrcode(typeNumber, errorCorrectionLevel);
                        qr.addData(qrData);
                        qr.make();
                        
                        // Create QR code as an image element
                        const qrImage = document.createElement('img');
                        qrImage.src = qr.createDataURL(4); // 4 is the cell size
                        qrImage.alt = `QR Code for ${computer.pcNumber}`;
                        qrImage.style.width = '100%';
                        qrImage.style.height = 'auto';
                        qrImage.style.display = 'block';
                        
                        qrDiv.appendChild(qrImage);
                    } catch (error) {
                        console.error('QR Code generation error:', error);
                        qrDiv.innerHTML = '<div style="text-align:center; padding:5px;">QR Error</div>';
                        qrDiv.style.display = 'flex';
                        qrDiv.style.alignItems = 'center';
                        qrDiv.style.justifyContent = 'center';
                    }
                    
                    const label = document.createElement('div');
                    label.className = 'qr-label';
                    label.innerHTML = `<strong>${lab.name}</strong><br>PC #: <strong>${computer.pcNumber}</strong>`;
                    
                    qrItem.appendChild(qrDiv);
                    qrItem.appendChild(label);
                    qrRow.appendChild(qrItem);
                });
                
                qrContainer.appendChild(qrRow);
            });
            
            // Hide the generate QR modal and show the QR display modal
            bootstrap.Modal.getInstance(document.getElementById('generateQRModal')).hide();
            new bootstrap.Modal(document.getElementById('qrDisplayModal')).show();
        }

        // Update computers dropdown when lab is selected in QR modal
        document.getElementById('qrLab').addEventListener('change', function() {
            const labId = parseInt(this.value);
            updateQRComputersDropdown(labId);
        });

        // Update computers dropdown for QR generation
        function updateQRComputersDropdown(labId) {
            const computersSelect = document.getElementById('qrComputers');
            
            // Clear existing options
            $('#qrComputers').empty();
            
            if (labId) {
                const labComputers = computers.filter(c => c.labId === labId);
                
                if (labComputers.length === 0) {
                    // Add a disabled option if no computers found
                    $('#qrComputers').append(new Option('No computers in this laboratory', '', true, true)).trigger('change');
                    $('#qrComputers').prop('disabled', true);
                } else {
                    $('#qrComputers').prop('disabled', false);
                    
                    // Add computers to the dropdown
                    labComputers.forEach(computer => {
                        $('#qrComputers').append(new Option(computer.pcNumber, computer.id, false, false));
                    });
                }
                
                // Trigger change to update Select2
                $('#qrComputers').trigger('change');
            } else {
                $('#qrComputers').empty().trigger('change');
                $('#qrComputers').prop('disabled', true);
            }
        }

        // Function to edit computer
        function editComputer(id) {
            const computer = computers.find(c => c.id === id);
            if (computer) {
                document.getElementById('editComputerId').value = computer.id;
                document.getElementById('editPcNumber').value = computer.pcNumber;
                document.getElementById('editComputerStatus').value = computer.status;
                
                // Populate lab select
                const labSelect = document.getElementById('editComputerLab');
                labSelect.innerHTML = '';
                laboratories.forEach(lab => {
                    const option = document.createElement('option');
                    option.value = lab.id;
                    option.textContent = lab.name;
                    if (lab.id === computer.labId) {
                        option.selected = true;
                    }
                    labSelect.appendChild(option);
                });
                
                new bootstrap.Modal(document.getElementById('editComputerModal')).show();
            }
        }

        // Function to delete computer
        function deleteComputer(id) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    computers = computers.filter(c => c.id !== id);
                    saveData();
                    updateComputersTable();
                    Swal.fire({
                        icon: 'success',
                        title: 'Success!',
                        text: 'Computer deleted successfully!',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'OK'
                    });
                }
            });
        }

        // Function to delete laboratory
        function deleteLaboratory(id) {
            const labComputers = computers.filter(c => c.labId === id);
            if (labComputers.length > 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error!',
                    text: 'Cannot delete laboratory with existing computers. Please delete or move the computers first.',
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    laboratories = laboratories.filter(l => l.id !== id);
                    saveData();
                    updateLaboratoriesTable();
                    populateLabSelects();
                    Swal.fire({
                        icon: 'success',
                        title: 'Success!',
                        text: 'Laboratory deleted successfully!',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'OK'
                    });
                }
            });
        }

        // Update laboratories table
        function updateLaboratoriesTable() {
            const tbody = document.getElementById('laboratoriesTableBody');
            tbody.innerHTML = '';
            
            laboratories.forEach(lab => {
                const computerCount = computers.filter(c => c.labId === lab.id).length;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${lab.name}</td>
                    <td>${computerCount}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteLaboratory(${lab.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update computers table
        function updateComputersTable() {
            const tbody = document.getElementById('computersTableBody');
            tbody.innerHTML = '';
            
            computers.forEach((computer, index) => {
                const statusClass = computer.status === 'Working' ? 'status-working' : 
                                  computer.status === 'Under Maintenance' ? 'status-maintenance' : 'status-defective';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${computer.labName}</td>
                    <td>${computer.pcNumber}</td>
                    <td><span class="${statusClass} fw-bold">${computer.status}</span></td>
                    <td>${new Date(computer.lastUpdated).toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' })}</td>
                    <td>
                        <button class="btn btn-sm btn-warning me-1" onclick="editComputer(${computer.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteComputer(${computer.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Populate laboratory selects
        function populateLabSelects() {
            const labSelects = [
                document.getElementById('computerLab'),
                document.getElementById('editComputerLab'),
                document.getElementById('qrLab')
            ];
            
            labSelects.forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="">Select Laboratory</option>';
                    laboratories.forEach(lab => {
                        const option = document.createElement('option');
                        option.value = lab.id;
                        option.textContent = lab.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('laboratories', JSON.stringify(laboratories));
            localStorage.setItem('computers', JSON.stringify(computers));
            localStorage.setItem('computerIdCounter', computerIdCounter.toString());
            localStorage.setItem('labIdCounter', labIdCounter.toString());
        }
    </script>
</body>
</html>